---
title: "What makes a popular Reddit post?"
author: "InterstellR"
date: "May 2, 2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Load packages and data

```{r load-packages, echo=FALSE, message=FALSE}
library(tidytext)
library(tidyverse)
library(scales)
```

```{r load-data, echo=FALSE, message=FALSE}
# This may take a while
posts <- read_csv('../data/reddit-posts.csv')
```

## Introduction

"Reddit is an American social news aggregation, web content rating, and discussion website" (from [Wikipedia](https://en.wikipedia.org/wiki/Reddit)). People who are members of Reddit upload their posts and other people vote and comment on said posts, the posts with the most likes appear more towards the top. They are divided by thematic categories called subreddits, as well as overall categories of top posts, new posts, controversial posts, among others.

### Data Set

The data set is comprised of Reddit posts from December 2017, since it was the latest data set we could find and wanted to keep up with the most recent trends. Also,  it will be interesting to explore themes related to Christmas. We retrieved it from the Google BigQuery API. The data set contains `r ncol(posts)` variables and `r nrow(posts)` observations. 

### Research Question

## Exploratory Analysis

As infrequent Reddit users, we did not know much about the various subreddits. Hence, we wanted to start by finding out what the most popular ones are and gain insights into what the posts in each one are about. As a measure of a subreddit's popularity, we decided to use the cumulative score of all of its posts. The plot below shows the ten subreddits with the highest resulting totals.

```{r active-subreddits}
popular_subs <- posts %>%
  group_by(subreddit) %>%
  summarize(
    num_posts = n(),
    total_score = sum(score)
  ) %>%
  arrange(desc(total_score)) %>%
  head(9)
ggplot(popular_subs, aes(x = reorder(subreddit, total_score), y = total_score * 1e-6)) +
  geom_col() +
  labs(
    title = 'Most popular subreddits',
    subtitle = 'in December 2017',
    x = '',
    y = 'Cumulative score of posts'
  ) +
  scale_y_continuous(
    label = unit_format('M'),
    breaks = seq(0, 25, length = 6),
    expand = c(0, 0)
  ) +
  scale_x_discrete(expand = c(0, 0)) +
  coord_flip() +
  theme_minimal()
```

We find that the nine most popular subreddits in descending order are `The_Donald`, `funny`, `politics`, `aww`, `pics`, `gaming`, `gifs`, `todayilearned`, and `me_irl`. We may be able to intuit what most of these subreddits are about from their name alone, but we wanted to know more about the content and central topics in each of them. Therefore, we decided to analyze the most frequent terms in each of these subreddits with the help of the `tidytext` package. We want to focus on the text contained in the title of the posts since it is the first thing that is visible to the users. Furthermore, we decided to filter out stop words such as "the" and "a" because they naturally appear very frequently and do not convey much about the content of any one particular subreddit.

```{r tf-analysis}
# count most frequent words for each subreddit
tidy_titles <- posts %>%
  filter(subreddit %in% popular_subs$subreddit) %>%
  unnest_tokens(word, title) %>%
  anti_join(stop_words, by = 'word') %>%
  count(subreddit, word, sort = TRUE) %>%
  group_by(subreddit) %>%
  top_n(10, wt = n) %>%
  ungroup() %>%
  arrange(subreddit, n) %>%
  mutate(order = row_number())
# plot results
ggplot(tidy_titles, aes(x = order, y = n, fill = subreddit)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~subreddit, scales = 'free') +
  labs(
    title = 'Most frequent words within various subreddits',
    subtitle = 'in December 2017',
    x = '',
    y = ''
  ) +
  scale_x_continuous(
    breaks = tidy_titles$order,
    labels = tidy_titles$word,
    expand = c(0, 0)
  ) +
  scale_y_continuous(expand = c(0, 0)) +
  coord_flip() +
  theme_minimal() +
  theme(panel.grid.major.y = element_blank())
```

TODO: Discuss results for this visualization

## Conclusion
